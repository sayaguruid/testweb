<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesanan Berhasil - Toko Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="bg-primary text-white py-3">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="h3 mb-0">
                        <i class="fas fa-check-circle me-2"></i>
                        Pesanan Berhasil
                    </h1>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="index.html" class="btn btn-light btn-sm">
                        <i class="fas fa-home me-1"></i>
                        Katalog
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container py-4">
        <!-- Loading -->
        <div id="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Memuat informasi pesanan...</p>
        </div>

        <!-- Success Message -->
        <div id="successMessage" style="display: none;">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <!-- Success Card -->
                    <div class="card mb-4">
                        <div class="card-body text-center py-5">
                            <div class="mb-4">
                                <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                            </div>
                            <h2 class="text-success mb-3">Pesanan Anda Berhasil!</h2>
                            <p class="lead">Terima kasih telah berbelanja di toko kami.</p>
                            <p class="text-muted">Pesanan Anda sedang diproses dan akan segera kami konfirmasi.</p>
                        </div>
                    </div>

                    <!-- Order Info Card -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-receipt me-2"></i>
                                Informasi Pesanan
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Order ID:</strong></p>
                                    <p class="h5 text-primary" id="orderId"></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Tanggal Pesanan:</strong></p>
                                    <p id="orderDate"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Nama:</strong></p>
                                    <p id="customerName"></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>WhatsApp:</strong></p>
                                    <p id="customerPhone"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Produk:</strong></p>
                                    <p id="productName"></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Jumlah:</strong></p>
                                    <p id="productQuantity"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Metode Pembayaran:</strong></p>
                                    <p id="paymentMethod"></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Total Harga:</strong></p>
                                    <p class="h5 text-primary" id="totalPrice"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tracking Card -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-search me-2"></i>
                                Lacak Pesanan Anda
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="mb-3">Gunakan link di bawah ini untuk melacak status pesanan Anda:</p>
                            <div class="input-group">
                                <input type="text" class="form-control" id="trackingLink" readonly>
                                <button class="btn btn-outline-primary" type="button" id="copyLinkBtn">
                                    <i class="fas fa-copy me-1"></i>
                                    Salin
                                </button>
                                <button class="btn btn-primary" type="button" id="openLinkBtn">
                                    <i class="fas fa-external-link-alt me-1"></i>
                                    Buka
                                </button>
                            </div>
                            <div class="mt-3">
                                <p class="mb-2">Atau masukkan Order ID secara manual:</p>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="manualOrderId" readonly>
                                    <button class="btn btn-success" type="button" id="trackBtn">
                                        <i class="fas fa-search me-1"></i>
                                        Lacak
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    <a href="index.html" class="btn btn-outline-primary w-100">
                                        <i class="fas fa-home me-2"></i>
                                        Kembali ke Katalog
                                    </a>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <a href="track.html" class="btn btn-outline-success w-100">
                                        <i class="fas fa-search me-2"></i>
                                        Halaman Tracking
                                    </a>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-12">
                                    <button class="btn btn-whatsapp w-100" id="whatsappBtn">
                                        <i class="fab fa-whatsapp me-2"></i>
                                        Hubungi Admin via WhatsApp
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Not Found -->
        <div id="orderNotFound" class="text-center py-5" style="display: none;">
            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
            <h4>Pesanan Tidak Ditemukan</h4>
            <p class="text-muted">Pesanan yang Anda cari tidak tersedia.</p>
            <a href="index.html" class="btn btn-primary">
                <i class="fas fa-home me-1"></i>
                Kembali ke Katalog
            </a>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0 text-muted">&copy; 2024 Toko Online. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        let currentOrder = null;

        // Load order when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('id');
            
            if (orderId) {
                loadOrder(orderId);
            } else {
                showOrderNotFound();
            }
            
            // Copy link button
            document.getElementById('copyLinkBtn').addEventListener('click', copyTrackingLink);
            
            // Open link button
            document.getElementById('openLinkBtn').addEventListener('click', openTrackingLink);
            
            // Track button
            document.getElementById('trackBtn').addEventListener('click', trackOrder);
            
            // WhatsApp button
            document.getElementById('whatsappBtn').addEventListener('click', contactWhatsApp);
        });

        // Load order from API
        async function loadOrder(orderId) {
            try {
                const response = await fetch(`${API_BASE_URL}/track?id=${orderId}`);
                const order = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                
                if (order.error) {
                    showOrderNotFound();
                    return;
                }
                
                currentOrder = order;
                displayOrderInfo(order);
                
            } catch (error) {
                console.error('Error loading order:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Gagal memuat informasi pesanan. Silakan refresh halaman.
                    </div>
                `;
            }
        }

        // Display order information
        function displayOrderInfo(order) {
            // Order info
            document.getElementById('orderId').textContent = order.order_id;
            document.getElementById('orderDate').textContent = formatDate(order.date);
            document.getElementById('customerName').textContent = order.name;
            document.getElementById('customerPhone').textContent = order.phone;
            document.getElementById('productName').textContent = order.product_name;
            document.getElementById('productQuantity').textContent = order.qty;
            document.getElementById('paymentMethod').textContent = order.payment_method;
            document.getElementById('totalPrice').textContent = `Rp ${formatNumber(order.total_price)}`;
            
            // Tracking link
            const trackingLink = `${window.location.origin}/track.html?id=${order.order_id}`;
            document.getElementById('trackingLink').value = trackingLink;
            document.getElementById('manualOrderId').value = order.order_id;
            
            document.getElementById('successMessage').style.display = 'block';
        }

        // Copy tracking link
        function copyTrackingLink() {
            const trackingLink = document.getElementById('trackingLink');
            trackingLink.select();
            document.execCommand('copy');
            
            const btn = document.getElementById('copyLinkBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check me-1"></i>Tersalin!';
            btn.classList.remove('btn-outline-primary');
            btn.classList.add('btn-success');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-primary');
            }, 2000);
        }

        // Open tracking link
        function openTrackingLink() {
            const trackingLink = document.getElementById('trackingLink').value;
            window.open(trackingLink, '_blank');
        }

        // Track order
        function trackOrder() {
            const orderId = document.getElementById('manualOrderId').value;
            window.location.href = `track.html?id=${orderId}`;
        }

        // Contact WhatsApp
        function contactWhatsApp() {
            if (currentOrder) {
                const message = `Halo, saya ingin menanyakan pesanan saya dengan Order ID: ${currentOrder.order_id}`;
                const whatsappUrl = `https://wa.me/628123456789?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            }
        }

        // Show order not found
        function showOrderNotFound() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('orderNotFound').style.display = 'block';
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Format number
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }
    </script>
</body>
</html>
